name: êµìœ¡ ë‰´ìŠ¤ í¬ë¡¤ë§

on:
  schedule:
    # ë§¤ì‹œê°„ ì •ì‹œì— ì‹¤í–‰ (í•œêµ­ì‹œê°„)
    - cron: "0 * * * *" # UTC ê¸°ì¤€ (í•œêµ­ì‹œê°„ -9ì‹œê°„)
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  crawl-news:
    runs-on: ubuntu-latest

    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: Python ì„¤ì •
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          pip install -r requirements.txt

      - name: í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        run: |
          echo "SPREADSHEET_ID=${{ secrets.SPREADSHEET_ID }}" >> $GITHUB_ENV
          echo "GOOGLE_CREDENTIALS_FILE=credentials.json" >> $GITHUB_ENV

      - name: Google Sheets ì¸ì¦ ì„¤ì •
        run: |
          echo '${{ secrets.GOOGLE_CREDENTIALS_JSON }}' > credentials.json

      - name: ë‰´ìŠ¤ í¬ë¡¤ë§ ì‹¤í–‰
        run: |
          echo "ğŸ”„ í¬ë¡¤ë§ ì‹œì‘: $(date)"
          python main_final.py
          echo "âœ… í¬ë¡¤ë§ ì™„ë£Œ: $(date)"

      - name: ê²°ê³¼ ì •ë¦¬ (ìš©ëŸ‰ ìµœì í™”)
        run: |
          echo "ğŸ“Š ì‹¤í–‰ ì‹œê°„: $(date)"
          echo "ğŸ“ í˜„ì¬ ë””ë ‰í† ë¦¬: $(pwd)"
          echo "ğŸ“„ ìƒì„±ëœ íŒŒì¼ë“¤:"
          ls -la *.json *.log 2>/dev/null || echo "íŒŒì¼ ì—†ìŒ"

          # ì˜¤ë˜ëœ ë¡œê·¸ íŒŒì¼ ì‚­ì œ (7ì¼ ì´ìƒ)
          find . -name "*.log" -mtime +7 -delete

          # JSON íŒŒì¼ ì••ì¶•
          gzip -k education_news_*.json 2>/dev/null || true

      - name: ê²°ê³¼ ì—…ë¡œë“œ (ì••ì¶•ëœ íŒŒì¼ë§Œ)
        uses: actions/upload-artifact@v3
        with:
          name: crawling-results
          path: |
            education_news_*.json.gz
            *.log
          retention-days: 7 # 7ì¼ í›„ ìë™ ì‚­ì œ
